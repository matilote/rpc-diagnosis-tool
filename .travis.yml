language: csharp
mono: none
sudo: required
os: osx
dotnet: 3.0.100

jobs:
  include:
    - stage: rocksdb test   
      script: |
        git clone git://github.com/Cyan4973/lz4.git
        brew install gcc
        brew install snappy
        brew install zstd
        make -C lz4/lib
        cp -L lz4/lib/liblz4.dylib ./liblz4_64.dylib
        make -C lz4/lib clean
        CFLAGS="-arch i386" CXXFLAGS="-arch i386" LDFLAGS="-arch i386" make -C lz4/lib
        cp -L lz4/lib/liblz4.dylib ./liblz4_32.dylib
        lipo -create ./liblz4_32.dylib ./liblz4_64.dylib -output ./liblz4.dylib
        cp -v ./liblz4.dylib lz4/lib/$(readlink lz4/lib/liblz4.dylib)
        touch lz4/lib/liblz4
        make -C lz4/lib install
        sh build-rocksdb.sh
      name: "RocksDB OSX Build"